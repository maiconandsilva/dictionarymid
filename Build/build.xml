<!-- 
This file build.xml should be located in directory Build
You must have Sun's Wireless Toolkit (WTK) installed (can be downloaded from http://java.sun.com/products/sjwtoolkit/download-2_5.html)
You must set wtk.home to your WTK installation directory
This build.xml can generate DictionaryForMIDs (Java ME and Java SE), DictionaryGeneration, JarCreator and BitmapFontGenerator
Using: run ant in directory Build
It runs well on both platforms windows/linux
The jar-tool must be in the path. Otherwise there will be an error during the preverifier run.
You also must have the antenna-bin-xxx.jar file in the Build directory (the file antenna-bin-xxx.jar is part of the Build CVS project; can also be downloaded from http://antenna.sourceforge.net)

Important note: the source files are UTF-8 encoded. In Sun's WTK, you must set in the file ktools.properties (found somewhere under wtklib) the following property:
javac.encoding=UTF-8
-->

<project name="allwork" default="build_all">

	<!-- <property name="wtk.home"  location="D:\WTK25"/> -->
	<property name="wtk.home"  location="c:\programme\WTK"/>
	<!-- <property name="wtk.home"  location="/home/peto/.netbeans/5.5beta2/emulators/wtk22_linux/emulator/wtk22"/> -->

	<property name="wtk.cldc.version"  			value="1.1"/>
	<property name="wtk.midp.version"  			value="2.0"/>
	<property name="wtk.optionalpda.enabled"  	value="true"/>

	<taskdef resource="antenna.properties" 		classpath="./antenna-bin-0.9.14.jar"/>
	<property name="antenna.jarfilename"  		value="antenna-bin-0.9.14.jar"/>

    <property name="VersionNumber" 		value="3.2.0"/>	<!-- version of tools / applications -->
    <property name="VersionStatus" 		value="Testversion 1"/>	<!-- status of version, e.g. "beta", "testversion 2" -->

  	<property name="Build" 				location="."/> 				<!-- current directory -->
  	<property name="Build.buildfilename" value="build.xml"/> 		<!-- name of this file -->
  	<property name="Build.buildfile" 	location="${Build}/${Build.buildfilename}"/> <!-- location of this file -->
	
  	<property name="DfM.inputbasedir" 	location="../DictionaryForMIDs"/>
  	<property name="DfM.outputbasedir" 	location="${Build}/DictionaryForMIDs"/>
	<property name="DfM.srcdir"     	location="${DfM.inputbasedir}/src"/>            		<!-- WTK reads the resource files from src -->
	<property name="DfM.resdir"     	location="${DfM.inputbasedir}/res"/>            		<!-- WTK reads the resource files from res -->
	<property name="DfM.classdir"   	location="${DfM.outputbasedir}/classes"/>        		<!-- WTK puts the class files to classes -->
	<property name="DfM.bindir"   		location="${DfM.outputbasedir}/bin"/>					<!-- WTK puts the resource files to bin -->
	<property name="DfM.manifest"   	location="${DfM.bindir}/MANIFEST.MF"/>					<!-- WTK puts the resource files to bin -->
	<property name="DfM.jarfile"    	location="${DfM.outputbasedir}/DictionaryForMIDs.jar"/> <!-- Put the file in the home directory (WTK puts the jar file to bin) -->
	<property name="DfM.jadfile"    	location="${DfM.outputbasedir}/DictionaryForMIDs.jad"/> <!-- Put the file in the home directory (WTK puts the jad file to bin) -->

	<property name="JavaSE.inputbasedir"  location="../JavaSE"/>
	<property name="JavaSE.outputbasedir" location="${Build}/JavaSE"/>
	<property name="JavaSE.srcdir" 		location="${JavaSE.inputbasedir}/src"/>
	<property name="JavaSE.classdir" 	location="${JavaSE.outputbasedir}/bin"/>
	<property name="JavaSE.jarfile" 	location="${JavaSE.outputbasedir}/DictionaryForMIDsPC.jar"/> <!-- todo: need to check with Stefan on name ! -->

	<property name="JC.inputbasedir"  	location="../JarCreator"/>
	<property name="JC.outputbasedir" 	location="${Build}/JarCreator"/>
	<property name="JC.srcdir" 			location="${JC.inputbasedir}/src"/>
	<property name="JC.classdir"    	location="${JC.outputbasedir}/bin"/>
	<property name="JC.jarfile"     	location="${JC.outputbasedir}/JarCreator.jar"/>
	
	<property name="DG.inputbasedir"  	location="../DictionaryGeneration"/>
	<property name="DG.outputbasedir"  	location="${Build}/DictionaryGeneration"/>
	<property name="DG.srcdir"  		location="${DG.inputbasedir}/src"/>
	<property name="DG.classdir"    	location="${DG.outputbasedir}/bin"/>
	<property name="DG.jarfile"     	location="${DG.outputbasedir}/DictionaryGeneration.jar"/>

	<property name="BFG.inputbasedir"  	location="../BitmapFontGenerator"/>
	<property name="BFG.outputbasedir"  location="${Build}/BitmapFontGenerator"/>
	<property name="BFG.srcdir"  		location="${BFG.inputbasedir}/src"/>
	<property name="BFG.classdir"    	location="${BFG.outputbasedir}/bin"/>
	<property name="BFG.jarfile"     	location="${BFG.outputbasedir}/fontgenerator.jar"/>

	<property name="packaging.subdir"  			value="files_for_packaging"/>
	<property name="packaging.readmefilename" 	value="README"/>
	<property name="packaging.gplfilename" 		value="COPYING"/>
	<property name="packaging.copyrightfile" 	value="${Build}/${packaging.subdir}/${packaging.gplfilename}"/>

	<property name="app.propertyfilename" 		value="Application.properties"/> 

	<property name="DfM.team"  			value="Gert Nuber (dict@kugihan.de) et al."/> <!-- need to occasionally find something better -->
	<property name="DfM.copyrightyear"  value="2005, 2006, 2007"/>

	
	<target name="clean_dfm">
	    <delete dir="${DfM.outputbasedir}"/>
	</target>

	<target name="clean_java_se">
	    <delete dir="${JavaSE.outputbasedir}"/>
	</target>
	
	<target name="clean_jc">
	    <delete dir="${JC.outputbasedir}"/>
	</target>
	
	<target name="clean_dg">
	    <delete dir="${DG.outputbasedir}"/>
	</target>

	<target name="clean_bfg">
	    <delete dir="${BFG.outputbasedir}"/>
	</target>

	<target name="clean_all" depends="clean_dfm,clean_java_se,clean_jc,clean_dg,clean_bfg">
	</target>

  	<!-- 
  		DictionaryForMIDs Java ME 
  	-->
	<target name="compile_dfm_java_me">
	    <mkdir dir="${DfM.classdir}"/>	 
	    <mkdir dir="${DfM.bindir}"/>	 
	    <wtkbuild srcdir="${DfM.srcdir}" preverify="false" target="1.1" source="1.2"  encoding="UTF-8" destdir="${DfM.classdir}" debug="on"/>
	</target>

	<target name="create_dfm_java_me_jadfile_and_manifest"> 
		<property name="DfM.MIDlet-Name" value="DictionaryForMIDs"/> 
	    <property name="DfM.MIDlet-Version" value="${VersionNumber}"/>
	    <property name="DfM.MicroEdition-Profile" value="MIDP-2.0"/>
	    <property name="DfM.MicroEdition-Configuration" value="CLDC-1.0"/>
	    <property name="DfM.Built-By" value="${user.name}"/>
	    <property name="DfM.MIDlet-1" value="DictionaryForMIDs, /icons/Application/DictionaryForMIDs.png, de.kugihan.dictionaryformids.hmi_java_me.DictionaryForMIDs"/>
	    <wtkjad jadfile="${DfM.jadfile}">
		    <attribute name="MIDlet-Name" value="${DfM.MIDlet-Name}"/>
		    <attribute name="MIDlet-Version" value="${DfM.MIDlet-Version}"/>
		    <attribute name="MicroEdition-Profile" value="${DfM.MicroEdition-Profile}"/>
		    <attribute name="MicroEdition-Configuration" value="${DfM.MicroEdition-Configuration}"/>
		    <attribute name="Built-By" value="${user.name}"/>
		    <attribute name="MIDlet-Vendor" value="${DfM.team}"/>
		    <attribute name="MIDlet-1" value="${DfM.MIDlet-1}"/>
		    <attribute name="MIDlet-Jar-URL" value="DictionaryForMIDs.jar"/>
		    <attribute name="MIDlet-Permissions" value="javax.microedition.io.Connector.file.read"/>
		    <attribute name="logLevel" value="0"/>
	  	</wtkjad>
      	<manifest file="${DfM.manifest}">
	      	<attribute name="MIDlet-Name" value="${DfM.MIDlet-Name}"/>
	      	<attribute name="MIDlet-Version" value="${DfM.MIDlet-Version}"/>
	      	<attribute name="MicroEdition-Profile" value="${DfM.MicroEdition-Profile}"/>
	      	<attribute name="MicroEdition-Configuration" value="${DfM.MicroEdition-Configuration}"/>
	      	<attribute name="Built-By" value="${user.name}"/>
	      	<attribute name="MIDlet-Vendor" value="${DfM.team}"/>
	      	<attribute name="MIDlet-1" value="${DfM.MIDlet-1}"/>
      	</manifest>
	</target>

	<target name="build_dfm_java_me" depends="compile_dfm_java_me,create_dfm_java_me_jadfile_and_manifest"> 
		<antcall target="create_application_property_file">
			<param name="destinationbasedir" 	value="${DfM.outputbasedir}"/>
		</antcall>
		<!-- note: the following wtkpackage task will fail on preverification if the jar tool is not in the path -->
	    <wtkpackage jarfile="${DfM.jarfile}" jadfile="${DfM.jadfile}" manifest="${DfM.manifest}" preverify="true">
	      	<fileset dir="${DfM.classdir}"/>
	      	<fileset dir="${DfM.resdir}"/>
	      	<fileset dir="${DfM.outputbasedir}" includes="${app.propertyfilename}"/>
	    </wtkpackage>
	</target>

	<target name="package_dfm_java_me_empty" depends="obfuscate_dfm_java_me"> 
		<property name="packaging.java_me_executeable.subdir" value="files_for_packaging/executeable_distribution"/>
		<antcall target="replace_keywords_readme">
			<param name="sourcebasedir" 		value="${DfM.inputbasedir}"/>
			<param name="destinationbasedir" 	value="${DfM.outputbasedir}"/>
			<param name="packaging.subdir" 		value="${packaging.java_me_executeable.subdir}"/>
		</antcall>
		<property name="DfM.zipfile_empty"	location="${DfM.outputbasedir}/DictionaryForMIDs_${version}_empty.zip"/>
		<zip destfile="${DfM.zipfile_empty}">
			<zipfileset file="${DfM.jarfile}"/>
			<zipfileset file="${DfM.jadfile}"/>
			<zipfileset file="${packaging.copyrightfile}"/>
			<zipfileset file="${DfM.outputbasedir}/${packaging.java_me_executeable.subdir}/${packaging.readmefilename}"/>
		</zip>
	</target>

	<target name="package_dfm_java_me_sources" depends="build_dfm_java_me">  <!-- dependency on build_dfm_java_me is included 
	                                                                              to ensure that the source compiles -->
		<property name="packaging.java_me_source.subdir" value="files_for_packaging/source_distribution"/>
		<antcall target="replace_keywords_readme">
			<param name="sourcebasedir" 		value="${DfM.inputbasedir}"/>
			<param name="destinationbasedir" 	value="${DfM.outputbasedir}"/>
			<param name="packaging.subdir" 		value="${packaging.java_me_source.subdir}"/>
		</antcall>
		<property name="DfM.zipfile_source"	location="${DfM.outputbasedir}/DictionaryForMIDs_${version}_source.zip"/>
		<zip destfile="${DfM.zipfile_source}">
			<zipfileset dir="${DfM.srcdir}" prefix="source/DictionaryForMIDs/src"/>
			<zipfileset dir="${DfM.resdir}" prefix="source/DictionaryForMIDs/res"/>
			<zipfileset dir="${Build}" prefix="source/Build" includes="${Build.buildfilename}"/>
			<zipfileset file="${packaging.copyrightfile}"/>
			<zipfileset file="${DfM.outputbasedir}/${packaging.java_me_source.subdir}/${packaging.readmefilename}"/>
		</zip>
	</target>

	<target name="do_obfuscate_dfm_java_me"> 
	    <wtkobfuscate jarfile="${DfM.jarfile}" jadfile="${DfM.jadfile}">
			<preserve class="de.kugihan.dictionaryformids.hmi_java_me.DictionaryForMIDs"/>
			<preserve class="de.kugihan.dictionaryformids.translation.normation.Normation"/>
	    	<preserve class="de.kugihan.dictionaryformids.translation.normation.NormationLat"/>
	    	<preserve class="de.kugihan.dictionaryformids.translation.normation.NormationGer"/>
	    	<preserve class="de.kugihan.dictionaryformids.translation.normation.NormationFil"/>
	    	<preserve class="de.kugihan.dictionaryformids.translation.normation.NormationEng"/>
	    	<preserve class="de.kugihan.dictionaryformids.translation.normation.NormationEng2"/>
	    	<preserve class="de.kugihan.dictionaryformids.translation.normation.NormationJpn"/>
	    	<preserve class="de.kugihan.dictionaryformids.translation.normation.NormationLat"/>
	    	<preserve class="de.kugihan.dictionaryformids.translation.normation.NormationRus"/>
	    	<preserve class="de.kugihan.dictionaryformids.translation.normation.NormationVie"/>
	    </wtkobfuscate>
		<!-- need to preverify again -->
		<wtkpreverify jarfile="${DfM.jarfile}" jadfile="${DfM.jadfile}"/>
	</target>
  	
	<target name="obfuscate_dfm_java_me" depends="build_dfm_java_me"> 
		<antcall target="do_obfuscate_dfm_java_me"/>
	</target>
	
	<target name="create_minimal_size_dfm_java_me" depends="compile_dfm_java_me,create_dfm_java_me_jadfile_and_manifest"> 
		<antcall target="create_application_property_file">
			<param name="destinationbasedir" 	value="${DfM.outputbasedir}"/>
		</antcall>
	    <wtkpackage jarfile="${DfM.jarfile}" jadfile="${DfM.jadfile}" manifest="${DfM.manifest}">
	      	<fileset dir="${DfM.classdir}"/>
	      	<fileset dir="${DfM.outputbasedir}" includes="${app.propertyfilename}"/>
	      	<fileset dir="${DfM.resdir}">
	      		<!-- do not include any icons -->
	      		<exclude name="icons/**"/>
	      	</fileset>
	    </wtkpackage>
		<antcall target="do_obfuscate_dfm_java_me"/>
	</target>
  	
  	<!-- 
  		DictionaryForMIDs Java SE
  	-->
	<target name="compile_dfm_java_se" depends="compile_dfm_java_me">
	    <mkdir dir="${JavaSE.classdir}"/>	 
	    <javac srcdir="${JavaSE.srcdir}"  classpath="${DfM.classdir}" encoding="UTF-8" destdir="${JavaSE.classdir}" debug="on" />
	</target>

	<target name="build_dfm_java_se" depends="compile_dfm_java_se"> 
		<antcall target="create_application_property_file">
			<param name="destinationbasedir" 	value="${JavaSE.outputbasedir}"/>
		</antcall>
	    <jar destfile="${JavaSE.jarfile}"  >
			<fileset dir="${DfM.classdir}"     	includes="de/kugihan/dictionaryformids/**"  />
	      	<fileset dir="${JavaSE.classdir}"  	includes="de/kugihan/dictionaryformids/**"  />
	      	<fileset dir="${JavaSE.outputbasedir}" includes="${app.propertyfilename}"/>
	      	<manifest>
	        	<attribute name="Built-By" 		value="${user.name}"/>
	        	<attribute name="Created-By" 	value="Stefan Martens"/>
	        	<attribute name="Main-Class" 	value="de.kugihan.dictionaryformids.hmi_java_se.DictionaryForSE"/>
	      	</manifest>
	    </jar>
	</target>
  	
  	<!-- 
  		JarCreator
  	-->
	<target name="compile_jc" depends="compile_dfm_java_me,compile_dfm_java_se">
	    <mkdir dir="${JC.classdir}"/>
	    <javac srcdir="${JC.srcdir}" classpath="${DfM.classdir};${JavaSE.classdir}" encoding="UTF-8" destdir="${JC.classdir}" debug="on"/>
	</target>

	<target name="build_jc" depends="compile_jc"> 
		<antcall target="create_application_property_file">
			<param name="destinationbasedir" 	value="${JC.outputbasedir}"/>
		</antcall>
	    <jar destfile="${JC.jarfile}"  >
	      	<fileset dir="${DfM.classdir}"     includes="de/kugihan/dictionaryformids/**"  />
	      	<fileset dir="${JC.classdir}"      includes="de/kugihan/jarCreator/JarCreator.class"  />
	      	<fileset dir="${JavaSE.classdir}"  includes="de/kugihan/dictionaryformids/**"  />
	      	<fileset dir="${JC.outputbasedir}" includes="${app.propertyfilename}"/>
	      	<manifest>
	        	<attribute name="Built-By" value="${user.name}"/>
	        	<attribute name="Created-By" value="Mathis Karmann"/>
	        	<attribute name="Main-Class" value="de.kugihan.jarCreator.JarCreator"/>
	      	</manifest>
	    </jar>
	</target>

	<target name="package_jc" depends="build_jc">
		<antcall target="replace_keywords_readme">
			<param name="sourcebasedir" 		value="${JC.inputbasedir}"/>
			<param name="destinationbasedir" 	value="${JC.outputbasedir}"/>
		</antcall>
		<property name="JC.zipfile"	location="${JC.outputbasedir}/DictionaryForMIDs_JarCreator_${version}.zip"/>
		<zip destfile="${JC.zipfile}">
			<zipfileset file="${JC.jarfile}"/>
			<zipfileset file="${packaging.copyrightfile}"/>
			<zipfileset file="${JC.outputbasedir}/${packaging.subdir}/${packaging.readmefilename}"/>
			<zipfileset dir="${Build}" prefix="source/Build" includes="${Build.buildfilename}"/>
			<zipfileset dir="${DfM.srcdir}" prefix="source/DictionaryForMIDs/src"/>
			<zipfileset dir="${JavaSE.srcdir}" prefix="source/JavaSE/src"/>
			<zipfileset dir="${JC.srcdir}" prefix="source/JarCreator/src"/>
		</zip>
	</target>
	
  	<!-- 
  		DictionaryGeneration
  	-->
	<target name="compile_dg" depends="compile_dfm_java_me,compile_dfm_java_se">
	    <mkdir dir="${DG.classdir}"/>
	    <javac srcdir="${DG.srcdir}" classpath="${DfM.classdir};${JavaSE.classdir}" encoding="UTF-8" destdir="${DG.classdir}" debug="on"/>
	</target>
	
	<target name="build_dg" depends="compile_dg"> 
		<antcall target="create_application_property_file">
			<param name="destinationbasedir" 	value="${DG.outputbasedir}"/>
		</antcall>
	    <jar destfile="${DG.jarfile}"  >
	      	<fileset dir="${DfM.classdir}"     includes="de/kugihan/dictionaryformids/**"  />
	      	<fileset dir="${DG.classdir}"      includes="de/kugihan/dictionaryformids/**"  />
	      	<fileset dir="${JavaSE.classdir}"  includes="de/kugihan/dictionaryformids/**"  />
	      	<fileset dir="${DG.outputbasedir}" includes="${app.propertyfilename}"  />
	      	<manifest>
	        	<attribute name="Built-By" value="${user.name}"/>
	        	<attribute name="Created-By" value="Gert Nuber"/>
	        	<attribute name="Main-Class" value="de.kugihan.dictionaryformids.dictgen.DictionaryGeneration"/>
	      	</manifest>
	    </jar>
	</target>

	<target name="package_dg" depends="build_dg">
		<antcall target="replace_keywords_readme">
			<param name="sourcebasedir" 		value="${DG.inputbasedir}"/>
			<param name="destinationbasedir" 	value="${DG.outputbasedir}"/>
		</antcall>
		<property name="DG.zipfile"	location="${DG.outputbasedir}/DictionaryForMIDs_DictionaryGeneration_${version}.zip"/>
		<zip destfile="${DG.zipfile}">
			<zipfileset file="${DG.jarfile}"/>
			<zipfileset file="${packaging.copyrightfile}"/>
			<zipfileset file="${DG.outputbasedir}/${packaging.subdir}/${packaging.readmefilename}"/>
			<zipfileset dir="${Build}" prefix="source/Build" includes="${Build.buildfilename}"/>
			<zipfileset dir="${DfM.srcdir}" prefix="source/DictionaryForMIDs/src"/>
			<zipfileset dir="${JavaSE.srcdir}" prefix="source/JavaSE/src"/>
			<zipfileset dir="${DG.srcdir}" prefix="source/DictionaryGeneration/src"/>
		</zip>
	</target>
	
  	<!-- 
  		BitmapFontGenerator
  	-->
	<target name="compile_bfg" depends="compile_dfm_java_me,compile_dfm_java_se">
	    <mkdir dir="${BFG.classdir}"/>
	    <javac srcdir="${BFG.srcdir}" classpath="${DfM.classdir};${JavaSE.classdir}" encoding="UTF-8" destdir="${BFG.classdir}" debug="on"/>
	</target>
	
	<target name="build_bfg" depends="compile_bfg"> 
		<antcall target="create_application_property_file">
			<param name="destinationbasedir" 	value="${BFG.outputbasedir}"/>
		</antcall>
	    <jar destfile="${BFG.jarfile}"  >
	      	<fileset dir="${DfM.classdir}"     includes="de/kugihan/dictionaryformids/**"  />
	      	<fileset dir="${BFG.classdir}"      includes="de/kugihan/fonttoolkit/**"  />
	      	<fileset dir="${JavaSE.classdir}"  includes="de/kugihan/dictionaryformids/**"  />
	      	<fileset dir="${BFG.outputbasedir}" includes="${app.propertyfilename}"/>
	      	<manifest>
	        	<attribute name="Built-By" value="${user.name}"/>
	        	<attribute name="Created-By" value="Sean Kernohan"/>
	        	<attribute name="Main-Class" value="de.kugihan.fonttoolkit.FontToolkit"/>
	      	</manifest>
	    </jar>
	</target>

	<target name="package_bfg" depends="build_bfg">
		<antcall target="replace_keywords_readme">
			<param name="sourcebasedir" 		value="${BFG.inputbasedir}"/>
			<param name="destinationbasedir" 	value="${BFG.outputbasedir}"/>
		</antcall>
		<property name="BFG.zipfile"	location="${BFG.outputbasedir}/DictionaryForMIDs_BitmapFontGenerator_${version}.zip"/>
		<zip destfile="${BFG.zipfile}">
			<zipfileset file="${BFG.jarfile}"/>
			<zipfileset file="${packaging.copyrightfile}"/>
			<zipfileset file="${BFG.outputbasedir}/${packaging.subdir}/${packaging.readmefilename}"/>
			<zipfileset dir="${Build}" prefix="source/Build" includes="${Build.buildfilename}"/>
			<zipfileset dir="${BFG.srcdir}" prefix="source/BitmapFontGenerator/src"/>
		</zip>
	</target>

	<!-- 
		general procedures that are called with antcall 
	-->
	<target name="replace_keywords_readme">
	    <property name="destinationdir"  	location="${destinationbasedir}/${packaging.subdir}"/>	 
	    <property name="destinationfile" 	location="${destinationdir}/${packaging.readmefilename}"/>
	    <property name="sourcefile" 		location="${sourcebasedir}/${packaging.subdir}/${packaging.readmefilename}"/>
	    <mkdir dir="${destinationdir}"/>
		<copy file="${sourcefile}" tofile="${destinationfile}"/>
		<replace file="${destinationfile}">
			<replacefilter token="$PackageVersion$" 		value="${version}"/>
			<replacefilter token="$CopyrightYear$" 			value="${DfM.copyrightyear}"/>
			<replacefilter token="$CopyrightGPLFilename$" 	value="${packaging.gplfilename}"/>
			<replacefilter token="$CopyrightBy$" 			value="${DfM.team}"/>
		</replace>
	</target>
		
	<target name="create_application_property_file">
	    <property name="destinationfile" 	location="${destinationbasedir}/${app.propertyfilename}"/>
		<propertyfile file="${destinationfile}" comment="The file is automatically created from build.xml">
		    <entry key="VersionNumber" value="${VersionNumber}"/>
		    <entry key="VersionStatus" value="${VersionStatus}"/>
		</propertyfile>
	</target>
		
	<target name="build_all" depends="build_dg,build_jc,build_bfg,build_dfm_java_se,build_dfm_java_me"/>
	
	<target name="package_all" depends="package_dg,package_jc,package_bfg,package_dfm_java_me_empty"/>

</project>

